---
format: gfm
---

# nodebpy

A package to help build node trees in blender more elegantly with python code.

## The Design Idea

Other projects have attempted similar but none quite handled the API how I felt it should be done. Notable existing projects are [geometry-script](https://github.com/carson-katri/geometry-script), [geonodes](https://github.com/al1brn/geonodes), [NodeToPython](https://github.com/BrendanParmer/NodeToPython). 

Other projects implement chaining of nodes mostly as dot methos of nodes to chain them (`InstanceOnPoints().set_position()`). This has the potential to crowd the API for individual nodes and easy chaining is instead approached via overriding the `>>` operator.

### Chain Nodes with `>>`

By default the operator attempts to link the first output of the previous node with the first input of the next. You can override this behaviour by being explicit with the socket you are passing out (`AccumulateField().o_total`) or using the `...` for the inputs into the next node. The dots can appear at multiple locations and each input will be linked to the previous node via the inferred or specified socket.

```{python}
from nodebpy import nodes, sockets, TreeBuilder

with TreeBuilder('NewTree') as tree:
    nodes.NamedAttribute("test", "INT") >> nodes.Math.power(2, ...)
```

## Example Node Tree
```{python}
import bpy
from nodebpy import nodes, sockets, TreeBuilder

bpy.ops.wm.read_homefile()

with TreeBuilder("AnotherTree") as tree:
    tree.interface(
        inputs=[sockets.SocketInt("Count")],
        outputs=[sockets.SocketGeometry("Instances")],
    )

    rotation = (
        nodes.RandomValue.vector(min=(-1, -1, -1), seed=2)
        >> nodes.AlignRotationToVector()
        >> nodes.RotateRotation()
    )

    _ = (
        tree.inputs.count
        >> nodes.Points(position=nodes.RandomValue.vector(min=(-1, -1, -1)))
        >> nodes.InstanceOnPoints(instance=nodes.Cube(), rotation=rotation)
        >> nodes.SetPosition(
            position=nodes.Position()
            >> nodes.VectorMath.scale(..., 2.0)
            >> nodes.VectorMath.add(b=(0, 0.2, 0.3)),
            offset=(0, 0, 0.1),
        )
        >> nodes.RealizeInstances()
        >> nodes.InstanceOnPoints(nodes.Cube(), instance=...)
        >> tree.outputs.instances
    )

# save as a .blendfile for inspection
mod = bpy.data.objects["Cube"].modifiers.new("TestModifier", "NODES")
mod.node_group = tree.tree
bpy.ops.wm.save_as_mainfile(filepath="example.blend")
```

![](images/paste-1.png)